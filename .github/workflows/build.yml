name: Release Builds

on:
	push:
		tags:
			- 'v*'
	workflow_dispatch:

jobs:
	build:
		name: Build ${{ matrix.os }}
		runs-on: ${{ matrix.os }}
		strategy:
			fail-fast: false
			matrix:
				os: [ubuntu-latest, macos-latest, windows-latest]

		env:
			GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

		steps:
			- name: Check out repository
				uses: actions/checkout@v4
					with:
						fetch-depth: 0

			- name: Set up Node.js
				uses: actions/setup-node@v4
				with:
					node-version: 20
					cache: npm

			- name: Install dependencies
				run: npm ci

					- name: Build and package
						run: npm run package -- --publish never

			- name: Upload artifacts to release
				uses: softprops/action-gh-release@v2
				with:
					files: |
						release/**/*.zip
						release/**/*.exe
						release/**/*.dmg
						release/**/*.AppImage
					fail_on_unmatched_files: false
				env:
					GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
